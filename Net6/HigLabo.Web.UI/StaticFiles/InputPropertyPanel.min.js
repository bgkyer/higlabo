var u,f;import{DateTime as i}from"./DateTime.js";import{$ as n}from"./HtmlElementQuery.js";import{HigLaboVue as t}from"./HigLaboVue.js";import{HttpClient as r}from"./HttpClient.js";import SelectTimePopupPanel from"./SelectTimePopupPanel.js";u=function(){function u(){this.selectTimePopupPanel=new SelectTimePopupPanel}return u.prototype.initialize=function(){this.selectTimePopupPanel.initialize();n("body").on("focusin","input[date-picker],input[time-picker]",this.dateTimeTextBox_Focusin.bind(this));n("body").on("keydown","input[date-picker]",this.dateTextBox_Keydown.bind(this));n("body").on("keydown","input[time-picker]",this.timeTextBox_Keydown.bind(this));n("body").on("keydown","[input-property-panel][element-type='Color'] input[type=text]",this.colorTextBox_Keydown.bind(this));n("body").on("keyup","[input-property-panel][element-type='Color'] input[type=text]",this.colorTextBox_Keyup.bind(this));n("body").on("click","[input-property-panel][element-type='Color'] [color-panel]",this.colorPanel_Click.bind(this));n("body").on("click","[input-property-panel][element-type='Color'] td[color]",this.colorCell_Click.bind(this));n("body").on("keydown","[input-property-panel][element-type='Color'] td[color]",this.colorCell_Keydown.bind(this));n("body").on("change","[input-property-panel] [set-by-end-time]",this.dateTimeDurationList_Change.bind(this));n("body").on("click","[input-property-panel]  [radio-button-label]",this.radioButtonLabel_Click.bind(this));n("body").on("click","[input-property-panel]  [checkbox-label]",this.checkBoxLabel_Click.bind(this));n("body").on("keydown","[input-property-panel] [delete-link]",this.deleteLink_Keydown.bind(this));n("body").on("click","[input-property-panel] [delete-link]",this.deleteLink_Click.bind(this));n("body").on("click","[input-property-panel] [add-record-button]",this.addRecordButton_Click.bind(this));n("body").on("click","[input-property-panel] [select-record-panel]",this.selectRecordPanel_Click.bind(this));n("body").on("keydown","[input-property-panel] [select-record-panel]",this.selectRecordPanel_Keydown.bind(this));n("body").on("click","[input-property-panel] [search-button]",this.searchButton_Click.bind(this));n("body").on("keydown","[input-property-panel] [search-textbox]",this.searchTextBox_Keydown.bind(this));n("body").on("click","[input-property-panel] [record-list-panel] [h-record]",this.record_Click.bind(this));n("body").on("click","[input-property-panel] [sort-button]",this.sortButton_Click.bind(this));n("body").on("click","[input-property-panel] [select-record-list-panel] [sort-record]",this.sortRecord_Click.bind(this));n("body").on("click","[input-property-panel] [close-button]",this.closeButton_Click.bind(this));n("body").on("keyup","[input-property-panel] [select-record-list-panel] [header-text-binding-panel] input[type=text]",this.editRecordPanelTextBox_Keyup.bind(this));n("body").on("keydown","[input-property-panel] [select-record-list-panel] [toggle-content-panel]",this.toggleContentPanel_Keydown.bind(this));n("body").on("click","[input-property-panel] [select-record-list-panel] [toggle-content-panel]",this.toggleContentPanel_Click.bind(this));n("body").on("keydown","[input-property-panel] [select-record-list-panel] [delete-candidate-link]",this.deleteCandidateLink_Keydown.bind(this));n("body").on("click","[input-property-panel] [select-record-list-panel] [delete-candidate-link]",this.deleteCandidateLink_Click.bind(this))},u.prototype.dateTimeTextBox_Focusin=function(t){n(t).select()},u.prototype.dateTextBox_Keydown=function(t,r){var s=t,o;if(s._flatpickr!=null&&(r.keyCode==40?s._flatpickr.open():s._flatpickr.close()),r.keyCode==9){var h=n(t),u=h.getValue(),e=i.getToday(),f=null;(u.length==1?f=e.toString("yyyy/MM/")+u:u.length==2?f=e.toString("yyyy/MM/")+u:u.length==3?f=e.toString("yyyy")+"/"+u.substr(0,1)+"/"+u.substr(1,2):u.length==4?f=e.toString("yyyy")+"/"+u.substr(0,2)+"/"+u.substr(2,2):u.length==5?f="20"+u.substr(0,2)+"/"+u.substr(2,1)+"/"+u.substr(3,2):u.length==6?f="20"+u.substr(0,2)+"/"+u.substr(2,2)+"/"+u.substr(4,2):u.length==8&&(f=u.substr(0,4)+"/"+u.substr(4,2)+"/"+u.substr(6,2)),f!=null)&&(o=new i(f),(u.length==1||u.length==2)&&o<e&&(o=e.addMonth(1)),h.setValue(o.toString("yyyy/MM/dd")))}},u.prototype.timeTextBox_Keydown=function(t,i){var e,u,f,r;(i.keyCode==40?this.selectTimePopupPanel.show(t):this.selectTimePopupPanel.hide(),i.keyCode==9)&&(e=n(t),u=e.getValue(),u.length==1&&(f=parseInt(u),r=0),u.length==2&&(f=parseInt(u),r=0),u.length==3&&(f=parseInt("0"+u.substr(0,1)),r=parseInt(u.substr(1,2))),u.length==4&&(f=parseInt(u.substr(0,2)),r=parseInt(u.substr(2,2))),u.length==5&&(f=parseInt(u.substr(0,2)),r=parseInt(u.substr(3,2))),r==NaN&&(r=0),0<=f&&f<30&&0<=r&&r<60?f<10?r<10?e.setValue("0"+f+":0"+r):e.setValue("0"+f+":"+r):r<10?e.setValue(f+":0"+r):e.setValue(f+":"+r):e.setValue(""))},u.prototype.colorTextBox_Keydown=function(n,t){t.keyCode==13&&this.showColorTable(n)},u.prototype.colorTextBox_Keyup=function(t){n(t).getNearest("[color-panel]").setStyle("background-color",n(t).getValue())},u.prototype.colorPanel_Click=function(n){this.showColorTable(n)},u.prototype.showColorTable=function(t){n(t).getNearest("[color-table-panel]").setStyle("display","block");n(t).getNearest("[color-table-panel]").find("td").setFocus()},u.prototype.colorCell_Click=function(t){var i=n(t).getAttribute("color");this.setColor(t,i)},u.prototype.colorCell_Keydown=function(t,i){var u=t.parentElement,f,r;i.keyCode==13?(f=n(t).getAttribute("color"),this.setColor(t,f)):i.keyCode==37?(n(t.previousElementSibling).setFocus(),i.stopPropagation()):i.keyCode==38?(r=n(t).getIndex(),n(u.previousElementSibling.children[r]).setFocus(),i.preventDefault()):i.keyCode==39?(n(t.nextElementSibling).setFocus(),i.stopPropagation()):i.keyCode==40&&(r=n(t).getIndex(),n(u.nextElementSibling.children[r]).setFocus(),i.preventDefault())},u.prototype.setColor=function(t,i){n(t).getNearest("[color-panel]").setStyle("background-color",i);n(t).getNearest("[color-table-panel]").hide();n(t).getNearest("input[type='text']").setValue(i).setFocus().select()},u.prototype.dateTimeDurationList_Change=function(n){this.toggleDateTimeDurationList(n)},u.prototype.toggleDateTimeDurationList=function(t){var i=n(t).getNearestElement("[duration-list-panel]"),r=n(t).getNearestElement("[duration-end-panel]");n(t).isChecked()?(n(i).setStyle("display","none"),n(r).setStyle("display","inline")):(n(i).setStyle("display","inline"),n(r).setStyle("display","none"))},u.prototype.radioButtonLabel_Click=function(t){n(t).getNearest("input[type='radio']").setChecked(!0).triggerEvent("change")},u.prototype.checkBoxLabel_Click=function(t){n(t).getNearest("input[type='checkbox']").toggleChecked().triggerEvent("change")},u.prototype.selectRecordPanel_Click=function(n){this.showSearchRecordListPanel(n)},u.prototype.selectRecordPanel_Keydown=function(n,t){t.keyCode==13&&this.showSearchRecordListPanel(n)},u.prototype.deleteLink_Click=function(n,t){this.deleteRecord(n);t.preventDefault()},u.prototype.deleteLink_Keydown=function(t,i){if(i.keyCode==13){var u=n(t).getParent("[h-record]").getFirstElement(),r=u.nextElementSibling;r==null&&(r=u.previousElementSibling);r!=null&&n(r).find("[delete-link]").setFocus();this.deleteRecord(t)}},u.prototype.deleteRecord=function(t){var u=n(t).getParent("[h-record]").getFirstElement(),f=n(t).getParentAttribute("element-type"),i,r;f=="Record"&&(i=n(t).getNearestElement("[select-record-panel]"),n(i).setInnerHtml(""),r=document.createElement("span"),n(r).setInnerText(i.getAttribute("default-text")),i.appendChild(r),n(i).setFocus());u.remove()},u.prototype.addRecordButton_Click=function(t){var i=n(t).getParent("[input-property-panel]"),f=i.getAttribute("add-record-mode"),u;switch(f){case"Search":n(t).getParent("[button-list-panel]").hide();this.showSearchRecordListPanel(t);break;case"Api":u=i.getAttribute("api-path-default-get");r.postJson(u,{},this.getDefaultRecordCallback.bind(this),null,i.getFirstElement())}},u.prototype.getDefaultRecordCallback=function(i,r){var f=r,s=f.getAttribute("template-id"),h=n(f).find("[select-record-list-panel]").getFirstElement(),e=i.jsonParse(),o=t.append(h,s,e)[0],c=n(o).getAttribute("h-key");u.setElementProperty(o,e,c);this.recordAdded()},u.prototype.recordAdded=function(){},u.prototype.showSearchRecordListPanel=function(t){var i=n(t).getNearestElement("[search-record-list-panel]");n(i).addClass("slide-down");n(t).getNearest("[search-textbox]").setFocus();this.search(t)},u.prototype.searchButton_Click=function(n){this.search(n)},u.prototype.searchTextBox_Keydown=function(t,i){var f=n(t).getNearest("[search-record-list-panel]"),u=f.find("[current]").getFirstElement(),r=null,h,e,o;if(i.keyCode==13){if(u==null){this.search(t);return}if(r=u.nextElementSibling,r==null&&(r=u.previousElementSibling),h=this.selectRecord(u),h==!1)return}if(e=f.find("[h-record]").getElementList(),e.length!=0){if(i.keyCode==8?r=null:i.keyCode==38?u==null?r=e[e.length-1]:(u.removeAttribute("current"),r=u.previousSibling):i.keyCode==40&&(o=f.find("[current]").getFirstElement(),o==null?r=e[0]:(o.removeAttribute("current"),r=o.nextElementSibling)),r==null)f.find("[current]").removeAttribute("current");else{var s=f.find("[record-list-panel]"),c=s.getOffset(),l=s.getScrollTop(),a=n(r).getOffset();s.setScrollTop(a.top-(c.top-l)-s.getOuterHeight()/2+40)}n(r).setAttribute("current","true")}},u.prototype.search=function(t){var u=n(t).getParent("[api-path-search]"),f=n(u).getAttribute("api-path-search"),i=null;try{i=JSON.parse(n(u).getAttribute("api-parameter"))}catch(e){}i==null&&(i={});i.SearchText=n(u).find("[search-textbox]").getValue();r.postJson(f,i,this.search_Callback.bind(this),null,u)},u.prototype.search_Callback=function(i,r){var f=i.jsonParse(),e=r,o=n(e).find("[record-list-panel]").getFirstElement(),s=n(e).getAttribute("search-template-id"),u;for(n(o).setInnerHtml(""),u=0;u<f.Data.length;u++)t.append(o,s,f.Data[u])},u.prototype.record_Click=function(n){this.selectRecord(n)},u.prototype.selectRecord=function(i){var f=n(i).getParent("[input-property-panel]"),y=n(f).getAttribute("h-record-list"),s=f.getAttribute("element-type"),p=f.getAttribute("select-record-mode"),e=n(i).getFirstElement(),l,r,o,h,c,v,a;switch(p){case"Html":if(s=="Record")r=n(f).find("[select-record-panel]").getFirstElement(),n(r).setInnerHtml(""),r.appendChild(e),n(r).setFocus(),this.closeSearchRecordListPanel(i);else if(s=="RecordList"){if(r=n(f).find("[select-record-list-panel]").getFirstElement(),o=n(e).getAttribute("h-key"),n(r).find("[h-key='"+o+"']").getElementCount()>0)return!1;r.appendChild(e);r.scrollTop=2e4}break;case"Template":if(l=f.getAttribute("template-id"),s=="Record")r=n(f).find("[select-record-panel]").getFirstElement(),n(e).setInnerHtml(""),h=u.createRecord(e),c=t.append(r,l,h),n(r).setFocus(),this.closeSearchRecordListPanel(i);else if(s=="RecordList"){if(r=n(f).find("[select-record-list-panel]").getFirstElement(),o=n(e).getAttribute("h-key"),n(r).find("[h-key='"+o+"']").getElementCount()>0)return!1;for(h=u.createRecord(e),c=t.append(r,l,h)[0],u.setRadioButtonProperty(c,y,o),v=n(c).find("input[type='checkbox']").getElementList(),a=0;a<v.length;a++);r.scrollTop=2e4}}return this.recordAdded(),!0},u.prototype.sortButton_Click=function(i){var r=n(i).getNearest("[select-record-list-panel]").getFirstElement();n(r).find("[h-record]").setAttribute("sort-record","true");t.insertBefore(r.children[0],"SortLinePanelTemplate",{Text:n(i).getValue()});n(r).getNearest("[sort-button]").hide()},u.prototype.sortRecord_Click=function(t,i){var r=n(t).getParent("[select-record-list-panel]").getFirstElement(),u=n(r).find("[sort-line-panel]").getFirstElement();r.insertBefore(t,u);n(t).removeAttribute("sort-record");n(r).find("[sort-record]").getElementCount()==0&&(u.remove(),n(r).getNearest("[sort-button]").removeStyle("display"));i.preventDefault()},u.prototype.closeButton_Click=function(n){this.closeSearchRecordListPanel(n)},u.prototype.closeSearchRecordListPanel=function(t){var i=n(t).getNearestElement("[search-record-list-panel]");n(i).removeClass("slide-down");n(t).getNearest("[button-list-panel]").setStyle("display","initial")},u.prototype.editRecordPanelTextBox_Keyup=function(t){var i=n(t).getValue();n(t).getNearest("[header-text]").setInnerText(i)},u.prototype.toggleContentPanel_Keydown=function(t,i){i.keyCode==13&&n(t).getParent("[h-record]").toggleAttributeValue("toggle-state","Expand","Collapse")},u.prototype.toggleContentPanel_Click=function(t){n(t).getParent("[h-record]").toggleAttributeValue("toggle-state","Expand","Collapse")},u.prototype.deleteCandidateLink_Keydown=function(n,t){t.keyCode==13&&this.deleteCandidate(n)},u.prototype.deleteCandidateLink_Click=function(n){this.deleteCandidate(n)},u.prototype.deleteCandidate=function(t){n(t).getParent("[h-record]").toggleAttributeValue("is-delete","true","false");n(t).getParent("[h-record]").find("input[h-name='IsDelete']").setValue("true")},u.createRecord=function(t){var f={},o=[],i,e,r,s;for(this.findChildNodes(t,o),i="",e=0;e<o.length;e++){if(r=o[e],i=n(r).getAttribute("h-record-list"),i!=""){f[i]=this.createRecordList(r);continue}if(i=n(r).getAttribute("h-record"),i!=""){s=this.createRecord(r);f[i]=s;continue}i=n(r).getAttribute("h-name");i!=""&&u.setRecordProperty(f,r)}return f},u.setRecordProperty=function(t,i){var r=n(i).getAttribute("h-name"),y=n(i).find("[h-record]").getFirstElement(),o,c,l,s,h,a,e,f,v;if(y!=null){t[r]=u.createRecord(y);return}if(o=n(i).find("textarea").getFirstElement(),o!=null)if(c=o.richTextbox,c==null)t[r]=n(o).getValue();else{t[r]=c.getData();return}if(l=n(i).find("select").getFirstElement(),l!=null){t[r]=n(l).getValue();return}for(s=n(i).find("input[type='radio']").getElementList(),h=0;h<s.length;h++)if(a=n(s[h]),a.isChecked()){t[r]=a.getValue();return}if(!(s.length>0)&&(e=n(i).find("input").getFirstElement(),e==null&&i.tagName.toUpperCase()=="INPUT"&&(e=i),e!=null)){f=n(e);switch(f.getAttribute("type")){case"text":case"password":case"hidden":v=f.getValue();v!=null&&(t[r]=v);break;case"radio":f.isChecked()&&(t[r]=f.getValue());break;case"checkbox":t[r]=f.isChecked()}}},u.createRecordList=function(t){for(var i,o,f=[],e=n(t).find("[h-record]").getElementList(),r=0;r<e.length;r++)(i=e[r],n(i).getParent("[h-record-list]").getFirstElement()==t)&&(n(i).getParent("[search-record-list-panel]").getElementCount()>0||(o=u.createRecord(i),f.push(o)));return f},u.findChildNodes=function(t,i){for(var r,e=n(t).getChildElementList(),f=0;f<e.length;f++)(r=e[f],n(r).getAttribute("[search-record-list-panel]")=="")&&(n(r).hasAttribute("h-name")||n(r).hasAttribute("h-record")||n(r).hasAttribute("h-record-list")?i.push(r):u.findChildNodes(r,i));return i},u.setElementProperty=function(t,i,r){for(var l,h,y,a,c,p,w=Object.getOwnPropertyNames(i),v=0;v<w.length;v++){var s=w[v],f=i[s],e=n(t).find("[h-name='"+s+"'],[h-record='"+s+"'],[h-record-list='"+s+"']"),o=e.getAttribute("element-type");if(o=="Color")e.find("input").setValue(f),e.find("[color-panel]").setStyle("background-color",f);else if(o=="CheckBox")r!="",e.find("input").setChecked(f);else if(o=="CheckBoxList")for(l=f,h=0;h<l.length;h++)(y=e.find("input[h-name='Value'][value='"+l[h].Value+"']").getFirstElement(),y!=null)&&n(y.parentElement).find("input[type='checkbox']").setChecked(l[h].Checked);else if(o=="SelectButton"||o=="RadioButtonList")r!=""&&u.setRadioButtonProperty(e.getFirstElement(),s,r),e.find("input[type=radio][value='"+f+"']").setChecked(!0);else if(o=="Date")f!=null&&f.length>10&&(f=f.replace(/-/g,"/").substr(0,10),n(e).find("[date-picker]").setValue(f));else if(o=="DateTime")f!=null&&(f.Date!=""&&n(e).find("[date-picker]").setValue(f.Date),f.HourMinute!=""&&n(e).find("[time-picker]").setValue(f.HourMinute));else if(o=="DateTimeDuration")u.setElementProperty(e.getFirstElement(),f,"");else if(o=="DropDownList")e.find("select").setValue(f);else if(o=="Record")u.setRecord(e.getFirstElement(),f);else if(o=="RecordList")u.setRecordList(e.getFirstElement(),f);else{if(a=e.getFirstElement(),a==null)continue;if(a.tagName.toLowerCase()=="input")n(a).setValue(f);else{c=e.find("input").getFirstElement();switch(n(c).getAttribute("type").toLowerCase()){case"radio":case"checkbox":n(c).setChecked(f);n(c).triggerEvent("change");break;default:n(c).setValue(f);p=e.find("textarea").getFirstElement();p!=null&&this.setTextArea(p,f)}}}}},u.setRadioButtonProperty=function(t,i,r){for(var o=n(t).find("input[type='radio']").getElementList(),f=0;f<o.length;f++){var u=o[f],s=n(u).getValue(),h=n(u).getParentAttribute("h-name"),e=i+"_"+r+"_"+h;n(u).setAttribute("name",e);n(u).setAttribute("id",e+"_"+s);n(u).getNearest("label").setAttribute("for",e+"_"+s)}},u.setCheckBoxProperty=function(t,i,r){var f=n(t).getAttribute("h-name"),u="CheckBox_"+i+"_"+r+"_"+f;n(t).find("input[type='checkbox']").setAttribute("id",u);n(t).find("label").setAttribute("for",u)},u.setTextArea=function(t,i){var r=i,u,f;r==null&&(r="");u=t;f=u.richTextbox;f==null?n(u).setValue(r):f.setData(r)},u.setRecord=function(i,r){if(r!=null){var u=n(i).find("[select-record-panel]"),f=i.getAttribute("template-id");n(u).setInnerHtml("");t.append(u.getFirstElement(),f,r)}},u.setRecordList=function(i,r){var o=n(i).find("[select-record-list-panel]"),h=i.getAttribute("template-id"),f,e,s;for(n(o).setInnerHtml(""),f=0;f<r.length;f++)e=t.append(o.getFirstElement(),h,r[f])[0],s=n(e).getAttribute("h-key"),u.setElementProperty(e,r[f],s)},u.setValidationResult=function(t,i){var r=i;n(t).find("[h-validation-name]").removeClass("fadein");setTimeout(function(){for(var i,u,t=0;t<r.length;t++)i=r[t],u=n("[h-validation-name='"+i.ParameterName+"']"),u.find("[text-panel]").setInnerText(i.Message),u.addClass("fadein")},10)},u}();f=function(){function n(){}return n}();export{u as InputPropertyPanel,f as ValidationResult};